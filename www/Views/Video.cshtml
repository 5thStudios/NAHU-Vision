@inherits Umbraco.Web.Mvc.UmbracoViewPage
@{Layout = "TopLevelVideo.cshtml";}

@{
    //Instantiate variables
    Boolean isLoggedIn = false;
    Boolean isFirst = true;
    string FullLoginResponse = "";
    HttpCookie cookie;

    //Determine if user is logged in and obtain full login info from cookie
    if (Request.Cookies["SessionGuid"] != null) { isLoggedIn = true; }
    cookie = HttpContext.Current.Request.Cookies["FullLoginResponse"];
    if (cookie != null) { FullLoginResponse = Uri.UnescapeDataString(cookie.Value); }

    //Obtain video data
    NAHUvision.Models.Video videoData = NAHUvision.Controller.VideoController.ObtainVideoData(Model, isLoggedIn, FullLoginResponse);
}

<div id="VideoPage" class="grid-x grid-padding-x grid-padding-y">
    <input type="hidden" id="hfldPageId" name="hfldPageId" value="@Model.Id" />
    <div class="cell large-16">
        <br />
        <div class="grid-x grid-padding-x grid-padding-y">
            <div class="cell">
                <h2>@videoData.Title</h2>

                <div class="grid-x grid-padding-x videoStatus">
                    <div class="cell">
                        @if (videoData.CompletedVideo)
                        {
                            <img alt="Completed" src="~/Images/Common/icons/completedIcon.png" title="Completed" />
                        }
                        @if (videoData.LockedVideo)
                        {
                            <img alt="Locked Video" src="/Images/Common/icons/LockIcon.png" title="Locked Video" />
                        }
                        @if (videoData.UnlockedVideo)
                        {
                            <img alt="Unlocked Video" src="/Images/Common/icons/UnlockIcon.png" title="Unlocked Video" />
                        }
                    </div>
                </div>
                <br />
                <div>
                    <span class="date">
                        @videoData.DatePublished.ToString("MMMM dd, yyyy")
                        |
                    </span>
                    <span class="categories">

                        @foreach (var link in videoData.LstCategoryLinks)
                        {
                            if (isFirst)
                            {
                                isFirst = false;
                            }
                            else
                            {
                                <span>&nbsp;|&nbsp;</span>
                            }
                            <a class="filter" data-filterby=".@link.Category" data-filterid="@link.Id">@link.Name</a>
                        }
                    </span>
                </div>
                <br />

                @Html.Raw(videoData.Description)

                @if (!isLoggedIn && videoData.LockedVideo)
                {
                    <div class="grid-x grid-padding-x grid-padding-y grid-margin-x grid-margin-y">
                        <div class="cell panel locked text-center">
                            <br>
                            <h3>Members Only</h3>
                            <h5>To view this video and many more, become a member today!</h5>
                            <div class="grid-x grid-padding-x grid-padding-y grid-margin-y">
                                <div class="cell small-12 text-right">
                                    <a class="button tertiary btnSignIn" onclick="return false;">Log In</a>
                                </div>
                                <div class="cell small-12 text-left">
                                    <a class="button" href="https://nahu.org/membership/join-now">Join</a>
                                </div>
                            </div>
                            <div class="readMore">
                                <a href="https://nahu.org/resources/member-benefits">View member benefits</a>
                            </div>
                            <br>
                        </div>
                    </div>
                }

            </div>

            <div class="cell">
                <div class="flex-video widescreen vimeo">
                    <iframe id="videoPlayer" src="@videoData.IframeUrl" width="640" height="360" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>
                    @if (videoData.LockedVideo)
                    {
                        <div class="lockedVideo">
                            <img alt="" class="" src="~/Images/Common/playBtnLocked.png" />
                        </div>
                    }
                </div>

                @if (!videoData.LockedVideo)
                {
                    <div class="grid-x  video-methods js-methods align-middle">
                        <div class="cell small-3 medium-2 large-1 text-left">
                            <input type="image" src="~/Images/Common/videoPlayBtn.png" alt="Play" class="js-method" data-method="play" title="Play">
                        </div>
                        <div class="cell small-3 small-offset-1 medium-2 medium-offset-0 large-1 text-left">
                            <input type="image" src="~/Images/Common/videoPauseBtn.png" alt="Pause" class="js-method" data-method="pause" title="Pause">
                        </div>
                        <div class="cell small-3 small-offset-1 medium-2 medium-offset-0 large-1">
                            <input id="btnBack" type="image" src="~/Images/Common/videoBackBtn.png" alt="Back 15 Seconds" title="Back 15 Seconds">
                        </div>
                        <div class="cell show-for-medium medium-13 medium-offset-1 large-18 large-offset-1 text-center">
                            <input id="current-time-range" type="range" min="0" max="1" step="any" value="0" disabled />
                        </div>
                        <div class="cell small-12 medium-4 large-2 text-right">
                            <label id="lblPercent">0 %</label>
                        </div>
                    </div>
                }
                
                <p class="output"></p>
            </div>

            <div class="cell text-center medium-text-right large-text-left">
                <div>
                    <a class="button" href="/">Back to Videos</a>
                </div>
                <br class="show-for-large" />
            </div>
        </div>
    </div>
    <div class="cell large-8">
        <br />
        @{Html.RenderAction("RenderFilter", "Filter");}
    </div>
</div>


@section finalScripts {
    <script type="text/javascript" src="https://player.vimeo.com/api/player.js"></script>
    <script type="text/javascript" src="~/Scripts/Custom/videoControls.js"></script>
    @*
        https://github.com/vimeo/player.js
        https://player.vimeo.com/api/demo
        https://vimeo.com/manage/videos
    *@
}